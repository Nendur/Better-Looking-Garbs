###################################
#
# Better Looking Garbs
#
# Events to alter ethnicity on newly created characters.
#
###################################

namespace = blg

# Ethnic diversity in random courtier spawns.
character_event = {
	id = blg.1
	hide_window = yes
	is_triggered_only = yes

	ai = yes
	min_age = 1
	trigger = {
		trait = blgspawn
	}
	immediate = {
		remove_trait = blgspawn
	}

	option = { # Leave unchanged / Ruler culture
		ai_chance = {
			factor = 6
		}
	}

	option = { # Local province
		ai_chance = { factor = 3 }
		trigger = {
			employer = {
				NOT = { character = no }
				is_landed = yes
				race = ROOT
			}
			OR = { dynasty = none num_of_dynasty_members <= 1 }
		}

		random_realm_province = {
			limit = { NOT = { province = no } }
			ROOT = {
				set_graphical_culture = PREV
			}
		}
	}

	option = { # Neighbour of local province
		ai_chance = { factor = 2 }
		trigger = {
			employer = {
				NOT = { character = no }
				is_landed = yes
				race = ROOT
			}
			OR = { dynasty = none num_of_dynasty_members <= 1 }
		}

		random_realm_province = {
			limit = { NOT = { province = no } }
			random_neighbor_province = {
				limit = { NOT = { province = no } }
				ROOT = {
					set_graphical_culture = PREV
				}
			}
		}
	}

	option = { # Bear species
		ai_chance = { factor = 100 }
		trigger = {
			OR = {
				graphical_culture = beargfx
				graphical_culture = polarbeargfx
				graphical_culture = blackbeargfx
			}
		}

		if = {
			limit = {
				location = {
					OR = {
						region = world_europe_north
						region = world_europe_east
					}
					climate = severe_winter
				}
			}
			set_graphical_culture = polar_bear
		}
		else_if = {
			limit = {
				location = {
					OR = {
						region = world_persia
						region = world_india
						region = world_steppe_east
						region = world_himalayas
					}
				}
			}
			set_graphical_culture = black_bear
		}
		else = {
			set_graphical_culture = bear
		}
	}
}

# Mixed ethnicity for children.
# Called from on_birth
character_event = {
	id = blg.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		remove_trait = blgspawn
	}
}

# Installatian check event.
character_event = {
	id    = blg.4
	title = blg.4.title
	desc  = blg.4.desc

	picture = GFX_evt_church_council
	border = GFX_event_normal_frame_intrigue
	hide_from = yes

	is_triggered_only = yes

	option = {
		name = blg.4.opt
	}
}

# Add additional freckled graphical cultures.
character_event = { 
	id = blg.7
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOR = {
			trait = freckles
			trait = freckles_2
			trait = freckles_3
			trait = freckles_4
			trait = freckles_5
		} 
		OR = { 
			graphical_culture = bretongfx
			graphical_culture = englishgfx
			graphical_culture = norsegaelgfx
			graphical_culture = tochariangfx
			AND = { 
				culture = uyghur
				graphical_culture = centralasiangfx 
			}
			AND = { 
				culture = komi #udmurt
				graphical_culture = ugricgfx 
			}
			mother_even_if_dead = { 
				OR = { 
					trait = freckles_3
					trait = freckles_2
					trait = freckles 
					trait = freckles_4
					trait = freckles_5
				} 
			}
			real_father_even_if_dead = { 
				OR = { 
					trait = freckles_3
					trait = freckles_2
					trait = freckles 
					trait = freckles_4
					trait = freckles_5
				} 
			}
			mother_even_if_dead = { #Rare cases of a non-gfx gaining the trait anyway due to mixed-race union.
				OR = { 
					graphical_culture = bretongfx
					graphical_culture = englishgfx
					graphical_culture = norsegaelgfx 
					graphical_culture = tochariangfx
					AND = { 
						culture = uyghur
						graphical_culture = centralasiangfx 
					}
					AND = { 
						culture = komi
						graphical_culture = ugricgfx 
					}
				} 
			}
			real_father_even_if_dead = { 
				OR = { 
					graphical_culture = bretongfx
					graphical_culture = englishgfx
					graphical_culture = norsegaelgfx 
					graphical_culture = tochariangfx
					AND = { 
						culture = uyghur
						graphical_culture = centralasiangfx 
					}
					AND = { 
						culture = komi
						graphical_culture = ugricgfx 
					}
				} 
			}
			real_father_even_if_dead = { 
				real_father_even_if_dead = { 
					OR = { 
						graphical_culture = bretongfx
						graphical_culture = englishgfx
						graphical_culture = norsegaelgfx 
						graphical_culture = tochariangfx
						AND = { 
							culture = uyghur
							graphical_culture = centralasiangfx 
						}
						AND = { 
							culture = komi
							graphical_culture = ugricgfx 
						}
					} 
				}
			}
			mother_even_if_dead = { 
				mother_even_if_dead = { 
					OR = { 
						graphical_culture = bretongfx
						graphical_culture = englishgfx
						graphical_culture = norsegaelgfx 
						graphical_culture = tochariangfx
						AND = { 
							culture = uyghur
							graphical_culture = centralasiangfx 
						}
						AND = { 
							culture = komi
							graphical_culture = ugricgfx 
						}
					} 
				}
			}
		}
	}
	immediate = { 
		random_list = { 
			2 = { 
				add_trait = freckles_5 
				modifier = { 
					factor = 5
					mother_even_if_dead = { trait = freckles_5 }
				}
				modifier = { 
					factor = 5
					real_father_even_if_dead = { trait = freckles_5 }
				}
				#Grandparents
				modifier = { 
					factor = 4
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_5 } }
				}
				modifier = { 
					factor = 4
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_5 } }
				}

				modifier = { 
					factor = 3
					mother_even_if_dead = { trait = freckles_4 }
				}
				modifier = { 
					factor = 3
					real_father_even_if_dead = { trait = freckles_4 }
				}
				#Grandparents
				modifier = { 
					factor = 2
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_4 } }
				}
				modifier = { 
					factor = 2
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_4 } }
				}
				#Multiplier bonus	
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles_4 }
					mother_even_if_dead = { trait = freckles_4 }
				}
				#The thickest versions should only appear if a parent already has the freckles gene, not appear out of nowhere.
				trigger = { 
					mother_even_if_dead = { 
						OR = { 
							trait = freckles_3
							trait = freckles_2
							trait = freckles 
							trait = freckles_4
							trait = freckles_5
						} 	
					}
					real_father_even_if_dead = { 
						OR = { 
							trait = freckles_3
							trait = freckles_2
							trait = freckles 
							trait = freckles_4
							trait = freckles_5
						} 
					}
				}
			}
			6 = { 
				add_trait = freckles_4 
				modifier = { 
					factor = 4
					mother_even_if_dead = { trait = freckles_4 }
				}
				modifier = { 
					factor = 4
					real_father_even_if_dead = { trait = freckles_4 }
				}
				#Grandparents
				modifier = { 
					factor = 3
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_4 } }
				}
				modifier = { 
					factor = 3
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_4 } }
				}
				
				modifier = { 
					factor = 2
					mother_even_if_dead = { trait = freckles }
				}
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles }
				}
				#Grandparents
				modifier = { 
					factor = 1.5
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles } }
				}
				modifier = { 
					factor = 1.5
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles } }
				}
				#Multiplier bonus	
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles }
					mother_even_if_dead = { trait = freckles }
				}
				#The thickest versions should only appear if a parent already has the freckles gene, not appear out of nowhere.
				trigger = { 
					mother_even_if_dead = { 
						OR = { 
							trait = freckles_3
							trait = freckles_2
							trait = freckles 
							trait = freckles_4
							trait = freckles_5
						} 	
					}
					real_father_even_if_dead = { 
						OR = { 
							trait = freckles_3
							trait = freckles_2
							trait = freckles 
							trait = freckles_4
							trait = freckles_5
						} 
					}
				}
			}
			7 = { 
				add_trait = freckles 
				modifier = { 
					factor = 4
					mother_even_if_dead = { trait = freckles }
				}
				modifier = { 
					factor = 4
					real_father_even_if_dead = { trait = freckles }
				}
				#Grandparents
				modifier = { 
					factor = 3
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles } }
				}
				modifier = { 
					factor = 3
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles } }
				}
				
				modifier = { 
					factor = 2
					mother_even_if_dead = { trait = freckles_2 }
				}
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles_2 }
				}
				#Grandparents
				modifier = { 
					factor = 1.5
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_2 } }
				}
				modifier = { 
					factor = 1.5
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_2 } }
				}
				#Multiplier bonus	
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles_2 }
					mother_even_if_dead = { trait = freckles_2 }
				}
				#The thickest versions should only appear if a parent already has the freckles gene, not appear out of nowhere.
				trigger = { 
					mother_even_if_dead = { 
						OR = { 
							trait = freckles_3
							trait = freckles_2
							trait = freckles 
							trait = freckles_4
							trait = freckles_5
						} 	
					}
					real_father_even_if_dead = { 
						OR = { 
							trait = freckles_3
							trait = freckles_2
							trait = freckles 
							trait = freckles_4
							trait = freckles_5
						} 
					}
				}
			}
			7 = { 
				add_trait = freckles_2 
				modifier = { 
					factor = 4
					mother_even_if_dead = { trait = freckles_2 }
				}
				modifier = { 
					factor = 4
					real_father_even_if_dead = { trait = freckles_2 }
				}
				#Grandparents
				modifier = { 
					factor = 3
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_2 } }
				}
				modifier = { 
					factor = 3
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_2 } }
				}
				
				modifier = { 
					factor = 2
					mother_even_if_dead = { trait = freckles_3 }
				}
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles_3 }
				}
				#Grandparents
				modifier = { 
					factor = 1.5
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_3 } }
				}
				modifier = { 
					factor = 1.5
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_3 } }
				}
				#Multiplier bonus	
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles_3 }
					mother_even_if_dead = { trait = freckles_3 }
				}
			}
			10 = { 
				add_trait = freckles_3 
				modifier = { 
					factor = 2
					mother_even_if_dead = { trait = freckles_3 }
				}
				modifier = { 
					factor = 2
					real_father_even_if_dead = { trait = freckles_3 }
				}
				#Grandparents
				modifier = { 
					factor = 1.5
					real_father_even_if_dead = { real_father_even_if_dead = { trait = freckles_3 } }
				}
				modifier = { 
					factor = 1.5
					mother_even_if_dead = { mother_even_if_dead = { trait = freckles_3 } }
				}
			}
			80 = { } #Nothing
		}
	}
}
